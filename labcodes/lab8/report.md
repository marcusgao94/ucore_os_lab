# 练习1

补充sfs_io_nolock函数，要实现的读文件过程是从给定的offset开始，到给定的endpos结束，以block为单位从磁盘上读取。按照注释中的提示，首先检查开始位置offset是否恰好在某个block起始处，若不在则单独处理从offset到第一个block起始处的部分，通过sfs_bmap_load_nolock获取磁盘实际编号，通过sfs_buf_op进行读写。之后通过sfs_block_op进行以块为单位的读写，直到endpos前最后一个block结束处。最后，若仍未到达endpos，则继续使用sfs_bmap_load_nolock和sfs_buf_op处理从最后一个block结束处到endpos之间的部分。

1. 
  在系统调用中实现管道的初始化和读写，通过创建文件或划分专门存储地址区段的方式维护一个数据缓冲区，并维护一个head指针和一个tail指针，分别用来读写文件，其中head和tail重合表示数据为空。采用管程或信号量的方式管理管道，确保同一时刻只能有一个进程在写数据，具体实现方式同课件中所讲的读者-写者问题。需要读数据时，采用循环方式从head指针向tail指针读（假设缓冲区段为[a, b]，则实际所读区段应为[head % (b - a) + a, tail % (b - a) + a]，当tail % (b - a) < head % (b - a)时，实际所读区段则为[a, tail % (b - a) + a]并上[head % (b - a) + a, b]），若缓冲区为空，则进程进入睡眠，等待其它写数据的进程，否则从缓冲区中读取数据。需要写数据时，首先要获得管道的访问权，之后向缓冲区的空闲空间写数据，若没有空闲空间，则进程进入睡眠，等待其它读数据的进程，最后释放控制权。

# 练习2

改写load_icode函数，将lab7中从内存中加载用户态程序修改为从文件系统中加载。首先统计各参数所占的空间总和，计算得出放置所有参数后的栈顶位置。然后建立堆栈，计算argv指针和argc的位置，并将每一个参数的值按顺序复制到argv处，在argc处设置好参数的个数。最后返回新的栈顶位置，并相应地设置参数即可。

1. 
  硬链接指文件与索引结点inode直接相连，在创建硬链接时，把新创建的文件的inode指向目标路径对应的inode，并将该inode的引用次数加1；在删除的时候，将对应inode的引用次数减1，当且仅当inode的引用次数降为0时，才真正删除并回收inode和原文件。

  软链接又叫符号链接，是包含了另一个文件的路径名的文件，其实质是指向另一个文件的间接指针，不受文件系统限制。创建软链接时，先创建一个新文件及其对应的inode，文件中存储目标路径，inode指定为链接类型。在删除时直接删除该链接文件及其对应的inode即可，不会影响到目标文件。